ext {
    ideaVersion = project.hasProperty('ideaVersion') ? project.getProperty('ideaVersion') : ideaVersion
    ideaDistArchive = "ideaIC-${ideaVersion}.tar.gz"
}

task downloadIdeaSdk << {
    ant.mkdir(dir: "$projectDir/lib")
    ant.get(src: "http://download.jetbrains.com/idea/${ideaDistArchive}",
            dest: "$projectDir/lib/${ideaDistArchive}", skipexisting: true)
}

task extractIdeaSdk << {
    def sdkDir = file("${projectDir}/lib/sdk-${ideaVersion}")
    def sdkTempDir = file("${sdkDir.absolutePath}-tmp")
    if (!sdkDir.exists()) {
        copy {
            from tarTree(resources.gzip("${projectDir}/lib/${ideaDistArchive}"))
            into sdkTempDir
        }
    }
    sdkTempDir.listFiles().find { it.name ==~ /idea-.+/ }.renameTo(sdkDir)
    sdkTempDir.deleteDir()
}

extractIdeaSdk.dependsOn downloadIdeaSdk
